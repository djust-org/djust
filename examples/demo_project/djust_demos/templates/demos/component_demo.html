{% extends "base.html" %}

{% block title %}Component Demo - djust{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-4">LiveComponent Demo</h1>
            <p class="lead">
                This demo showcases the LiveComponent system with parent-child communication,
                state isolation, and coordinated updates.
            </p>
        </div>
    </div>

    <!-- Main Component Demo -->
    <div class="row" data-liveview-root data-live-view="demo_app.views.component_demo.ComponentDemoView">
        <!-- User List Component (Left Column) -->
        <div class="col-md-4">
            {{ user_list.render }}
        </div>

        <!-- User Detail & Tasks (Right Column) -->
        <div class="col-md-8">
            <div class="row">
                <!-- User Detail Component -->
                <div class="col-12 mb-3">
                    {{ user_detail.render }}
                </div>

                <!-- Todo List Component -->
                <div class="col-12">
                    {{ todo_list.render }}
                </div>
            </div>
        </div>

        <!-- Event Log (Debugging) -->
        <div class="col-12 mt-4">
            <div class="card">
                <div class="card-header">
                    <h5>Event Log (Latest 10)</h5>
                </div>
                <div class="card-body">
                    {% if event_log %}
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Component ID</th>
                                    <th>Event</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for entry in event_log reversed %}
                                <tr>
                                    <td><code>{{ entry.component_id }}...</code></td>
                                    <td><span class="badge bg-info">{{ entry.event }}</span></td>
                                    <td><code>{{ entry.data }}</code></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-muted text-center">No events yet. Click a user to see events.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div><!-- /data-liveview-root -->

    <!-- Documentation -->
    <div class="row mt-4">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5>How it Works</h5>
                </div>
                <div class="card-body">
                    <h6>Component Architecture:</h6>
                    <ul>
                        <li><strong>UserListComponent</strong>: Displays users and handles selection</li>
                        <li><strong>UserDetailComponent</strong>: Shows details of selected user</li>
                        <li><strong>TodoComponent</strong>: Manages tasks with progress tracking</li>
                    </ul>

                    <h6 class="mt-3">Communication Flow:</h6>
                    <ol>
                        <li>User clicks on a user in the list â†’ <code>UserListComponent</code></li>
                        <li>Component calls <code>send_parent("user_selected", {user_id})</code></li>
                        <li>Parent view's <code>handle_component_event()</code> receives event</li>
                        <li>Parent updates state and calls <code>component.update(props)</code> on children</li>
                        <li>Components re-render with new props</li>
                    </ol>

                    <h6 class="mt-3">Key Features:</h6>
                    <ul>
                        <li><strong>Props Down</strong>: Parent passes data to children via <code>mount()</code> and <code>update()</code></li>
                        <li><strong>Events Up</strong>: Children notify parent via <code>send_parent()</code></li>
                        <li><strong>State Isolation</strong>: Each component manages its own state independently</li>
                        <li><strong>Automatic Registration</strong>: Components auto-register when added to context</li>
                        <li><strong>Computed Properties</strong>: Components can override <code>get_context_data()</code> for derived values</li>
                    </ul>

                    <h6 class="mt-3">Try It:</h6>
                    <ol>
                        <li>Click different users in the left panel to see details update</li>
                        <li>Toggle task checkboxes to see progress update</li>
                        <li>Watch the event log to see parent-child communication</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Example -->
    <div class="row mt-4">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5>Code Example</h5>
                </div>
                <div class="card-body">
                    <h6>Creating a LiveComponent:</h6>
                    <pre><code>class UserListComponent(LiveComponent):
    template_string = """&lt;div&gt;...&lt;/div&gt;"""

    def mount(self, users=None, selected_id=None):
        self.users = users or []
        self.selected_id = selected_id

    def select_user(self, id: str = None, **kwargs):
        self.send_parent("user_selected", {"user_id": int(id)})</code></pre>

                    <h6 class="mt-3">Using in Parent View:</h6>
                    <pre><code>class DemoView(LiveView):
    def mount(self, request, **kwargs):
        # Create component
        self.user_list = UserListComponent(users=self.users)

    def handle_component_event(self, component_id, event, data):
        if event == "user_selected":
            user_id = data["user_id"]
            # Update other components
            self.user_detail.update(user=self.find_user(user_id))</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
