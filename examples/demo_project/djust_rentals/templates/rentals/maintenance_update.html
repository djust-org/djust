{% extends "rentals/base.html" %}

{% block title %}Update Maintenance Request{% endblock %}

{% block content %}
<div class="py-6" data-djust-root data-djust-view="djust_rentals.views.maintenance.MaintenanceUpdateView">
  <div class="container mx-auto px-4 max-w-3xl">
    <!-- Page Header -->
    {{ page_header|safe }}

    {% if success_message %}
    <div class="bg-green-500/10 border border-green-500/20 text-green-600 dark:text-green-400 px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
      <i data-lucide="check-circle" class="w-5 h-5"></i>
      <span>{{ success_message }}</span>
    </div>
    {% endif %}

    {% if error_message %}
    <div class="bg-destructive/10 border border-destructive text-destructive-foreground px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
      <i data-lucide="alert-circle" class="w-5 h-5"></i>
      <span>{{ error_message }}</span>
    </div>
    {% endif %}

    <div class="bg-card border border-border rounded-lg p-6 space-y-6">
      <!-- Update Status -->
      <div>
        <div class="flex items-center gap-2 mb-3">
          <i data-lucide="activity" class="w-5 h-5 text-primary"></i>
          <h3 class="text-lg font-semibold text-card-foreground">Update Status</h3>
        </div>
        <div class="flex flex-wrap gap-2">
          {% for val, label in status_choices %}
          <button
            dj-click="update_status"
            data-status="{{ val }}"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors border
            {% if request.status == val %}
              {% if val == 'completed' %}
                bg-green-500 text-white border-green-500
              {% elif val == 'in_progress' %}
                bg-blue-500 text-white border-blue-500
              {% elif val == 'cancelled' %}
                bg-red-500 text-white border-red-500
              {% else %}
                bg-primary text-primary-foreground border-primary
              {% endif %}
            {% else %}
              bg-muted text-muted-foreground border-border hover:bg-accent
            {% endif %}"
          >
            {% if val == 'completed' %}
              <i data-lucide="check-circle" class="w-4 h-4"></i>
            {% elif val == 'in_progress' %}
              <i data-lucide="loader" class="w-4 h-4"></i>
            {% elif val == 'cancelled' %}
              <i data-lucide="x-circle" class="w-4 h-4"></i>
            {% else %}
              <i data-lucide="clock" class="w-4 h-4"></i>
            {% endif %}
            {{ label }}
          </button>
          {% endfor %}
        </div>
      </div>

      <!-- Update Priority -->
      <div class="pt-6 border-t border-border">
        <div class="flex items-center gap-2 mb-3">
          <i data-lucide="alert-triangle" class="w-5 h-5 text-primary"></i>
          <h3 class="text-lg font-semibold text-card-foreground">Update Priority</h3>
        </div>
        <div class="flex flex-wrap gap-2">
          {% for val, label in priority_choices %}
          <button
            dj-click="update_priority"
            data-priority="{{ val }}"
            class="inline-flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors border
            {% if request.priority == val %}
              {% if val == 'urgent' %}
                bg-red-500 text-white border-red-500
              {% elif val == 'high' %}
                bg-orange-500 text-white border-orange-500
              {% elif val == 'medium' %}
                bg-yellow-500 text-white border-yellow-500
              {% else %}
                bg-green-500 text-white border-green-500
              {% endif %}
            {% else %}
              bg-muted text-muted-foreground border-border hover:bg-accent
            {% endif %}"
          >
            {{ label }}
          </button>
          {% endfor %}
        </div>
      </div>

      <!-- Update Details Form -->
      <form dj-submit="update_details" class="space-y-4 pt-6 border-t border-border">
        <div class="flex items-center gap-2 mb-3">
          <i data-lucide="file-edit" class="w-5 h-5 text-primary"></i>
          <h3 class="text-lg font-semibold text-card-foreground">Update Details</h3>
        </div>

        <!-- Assigned To -->
        <div>
          <label class="block text-sm font-medium text-card-foreground mb-1">
            Assigned To
          </label>
          <div class="relative">
            <i data-lucide="user-check" class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"></i>
            <input
              type="text"
              name="assigned_to"
              class="w-full bg-background border border-input rounded-md pl-10 pr-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
              value="{{ request.assigned_to }}"
              placeholder="Contractor name..."
            />
          </div>
        </div>

        <!-- Cost Fields -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Estimated Cost -->
          <div>
            <label class="block text-sm font-medium text-card-foreground mb-1">
              Estimated Cost
            </label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground">$</span>
              <input
                type="number"
                step="0.01"
                name="estimated_cost"
                class="w-full bg-background border border-input rounded-md pl-7 pr-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                value="{% if request.estimated_cost %}{{ request.estimated_cost }}{% endif %}"
                min="0"
              />
            </div>
          </div>

          <!-- Actual Cost -->
          <div>
            <label class="block text-sm font-medium text-card-foreground mb-1">
              Actual Cost
            </label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground">$</span>
              <input
                type="number"
                step="0.01"
                name="actual_cost"
                class="w-full bg-background border border-input rounded-md pl-7 pr-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                value="{% if request.actual_cost %}{{ request.actual_cost }}{% endif %}"
                min="0"
              />
            </div>
          </div>
        </div>

        <!-- Add Note -->
        <div>
          <label class="block text-sm font-medium text-card-foreground mb-1">
            Add Note
          </label>
          <textarea
            name="notes"
            class="w-full bg-background border border-input rounded-md px-3 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
            rows="3"
            placeholder="Add update notes with timestamp..."
          ></textarea>
          <p class="text-xs text-muted-foreground mt-1">Note will be timestamped and appended to existing notes</p>
        </div>

        <!-- Form Actions -->
        <div class="flex gap-3 pt-4">
          <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors bg-primary text-primary-foreground hover:bg-primary/90">
            <i data-lucide="save" class="w-4 h-4"></i>
            Save Details
          </button>
          <a href="{% url 'rentals:maintenance-detail' request.pk %}" class="inline-flex items-center gap-2 px-4 py-2 rounded-md font-medium transition-colors bg-muted text-muted-foreground hover:bg-accent border border-border">
            <i data-lucide="x" class="w-4 h-4"></i>
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
